<?php
/**
 * @file
 * Code for the HPS Encyclopedia feature.
 */

include_once 'hps_encyclopedia.features.inc';

/**
 * Implements hook_views_pre_render().
 */
function hps_encyclopedia_views_pre_render(&$view) {

  foreach ($view->result as $delta => $row) {
    // Manipulate Bitstreams
    if (property_exists($row, 'field_dspace_bitstream_url')) {
      // Hide body field if bitsream was PDF
      if (property_exists($row, 'field_body')) {
        foreach ($row->field_dspace_bitstream_url as $field) {
          if (preg_match('/\.pdf\.txt/', $field['rendered'])) {
            $view->result[$delta]->field_body[0]['rendered']['#access'] = FALSE;
          }
        }
      }
    }

    // Alter creator string
    if (property_exists($row, 'field_dc_creator')) {
      $creator = explode(', ', $row->field_dc_creator[0]['raw']['value']);
      $view->result[$delta]->field_dc_creator[0]['rendered']['#markup'] =  "{$creator[1]} {$creator[0]}";
    }
  }
}
